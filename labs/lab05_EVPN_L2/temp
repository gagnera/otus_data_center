hostname SP0
!
spanning-tree mode mstp
!
interface Ethernet1
   description LF0
   no switchport
   ip address 10.0.0.1/30
!
interface Ethernet2
   description LF1
   no switchport
   ip address 10.0.0.5/30
!
interface Ethernet3
   description LF2
   no switchport
   ip address 10.0.0.9/30
!
interface Ethernet4
   description LF3
   no switchport
   ip address 10.0.0.13/30
!
interface Ethernet5
!
interface Ethernet6
!
interface Ethernet7
!
interface Ethernet8
!
interface Loopback0
   ip address 10.0.255.0/32
!
interface Management1
!
ip routing
!
router bgp 65000
   router-id 10.0.255.0
   timers bgp 1 3
   bgp listen range 10.0.254.0/24 peer-group EVPN remote-as 65000
   bgp listen range 10.0.0.0/24 peer-group LEAF remote-as 65000
   neighbor EVPN peer group
   neighbor EVPN update-source Loopback0
   neighbor EVPN route-reflector-client
   neighbor EVPN send-community extended
   neighbor LEAF peer group
   neighbor LEAF bfd
   neighbor LEAF route-reflector-client
   redistribute connected
   !
   address-family evpn
      neighbor EVPN activate
   !
   address-family ipv4
      network 10.0.255.0/32
!
end


'''

hostname SP1
!
spanning-tree mode mstp
!
interface Ethernet1
!
interface Ethernet2
   description LF0
   no switchport
   ip address 10.0.1.1/30
!
interface Ethernet3
   description LF1
   no switchport
   ip address 10.0.1.5/30
!
interface Ethernet4
   description LF2
   no switchport
   ip address 10.0.1.9/30
!
interface Ethernet5
   description LF3
   no switchport
   ip address 10.0.1.13/30
!
interface Ethernet6
!
interface Ethernet7
!
interface Ethernet8
!
interface Loopback0
   ip address 10.0.255.1/32
!
interface Management1
!
ip routing
!
router bgp 65000
   router-id 10.0.255.1
   timers bgp 1 3
   bgp listen range 10.0.254.0/24 peer-group EVPN remote-as 65000
   bgp listen range 10.0.1.0/24 peer-group LEAF remote-as 65000
   neighbor EVPN peer group
   neighbor EVPN update-source Loopback0
   neighbor EVPN route-reflector-client
   neighbor EVPN send-community extended
   neighbor LEAF peer group
   neighbor LEAF bfd
   neighbor LEAF route-reflector-client
   redistribute connected
   !
   address-family evpn
      neighbor EVPN activate
   !
   address-family ipv4
      network 10.0.255.1/32


'''

hostname LF2
!
spanning-tree mode mstp
!
vlan 200
!
interface Ethernet1
!
interface Ethernet2
!
interface Ethernet3
   description SP0
   no switchport
   ip address 10.0.0.10/30
!
interface Ethernet4
   description SP1
   no switchport
   ip address 10.0.1.10/30
!
interface Ethernet5
!
interface Ethernet6
!
interface Ethernet7
!
interface Ethernet8
   description CL20
   switchport access vlan 200
!
interface Loopback0
   ip address 10.0.254.2/32
!
interface Management1
!
interface Vxlan1
   vxlan source-interface Loopback0
   vxlan udp-port 4789
   vxlan vlan 200 vni 200
   vxlan learn-restrict any
!
ip routing
!
router bgp 65000
   router-id 10.0.254.2
   timers bgp 1 3
   maximum-paths 2
   neighbor EVPN peer group
   neighbor EVPN remote-as 65000
   neighbor EVPN update-source Loopback0
   neighbor EVPN send-community extended
   neighbor 10.0.0.9 remote-as 65000
   neighbor 10.0.0.9 bfd
   neighbor 10.0.1.9 remote-as 65000
   neighbor 10.0.1.9 bfd
   neighbor 10.0.255.0 peer group EVPN
   neighbor 10.0.255.1 peer group EVPN
   !
   vlan 200
      rd 65000:200
      route-target import 65000:200
      route-target export 65000:200
      redistribute learned
   !
   address-family evpn
      neighbor EVPN activate
   !
   address-family ipv4
      network 10.0.254.2/32

'''

hostname LF1
!
spanning-tree mode mstp
!
vlan 100
!
interface Ethernet1
!
interface Ethernet2
   description SP0
   no switchport
   ip address 10.0.0.6/30
!
interface Ethernet3
   description SP1
   no switchport
   ip address 10.0.1.6/30
!
interface Ethernet4
!
interface Ethernet5
!
interface Ethernet6
!
interface Ethernet7
!
interface Ethernet8
   description CL10
   switchport access vlan 100
!
interface Loopback0
   ip address 10.0.254.1/32
!
interface Management1
!
interface Vxlan1
   vxlan source-interface Loopback0
   vxlan udp-port 4789
   vxlan vlan 100 vni 100
   vxlan learn-restrict any
!
ip routing
!
router bgp 65000
   router-id 10.0.254.1
   timers bgp 1 3
   maximum-paths 2 ecmp 2
   neighbor EVPN peer group
   neighbor EVPN remote-as 65000
   neighbor EVPN update-source Loopback0
   neighbor EVPN send-community extended
   neighbor 10.0.0.5 remote-as 65000
   neighbor 10.0.0.5 bfd
   neighbor 10.0.1.5 remote-as 65000
   neighbor 10.0.1.5 bfd
   neighbor 10.0.255.0 peer group EVPN
   neighbor 10.0.255.1 peer group EVPN
   !
   vlan 100
      rd 65000:100
      route-target import 65000:100
      route-target export 65000:100
      redistribute learned
   !
   address-family evpn
      neighbor EVPN activate
   !
   address-family ipv4
      network 10.0.254.1/32


'''

hostname LF0
!
spanning-tree mode mstp
!
vlan 100,200
!
interface Ethernet1
   description SP0
   no switchport
   ip address 10.0.0.2/30
!
interface Ethernet2
   description SP1
   no switchport
   ip address 10.0.1.2/30
!
interface Ethernet3
!
interface Ethernet4
!
interface Ethernet5
!
interface Ethernet6
!
interface Ethernet7
   description CL00
   switchport access vlan 100
!
interface Ethernet8
   description CL01
   switchport access vlan 200
!
interface Loopback0
   ip address 10.0.254.0/32
!
interface Management1
!
interface Vxlan1
   vxlan source-interface Loopback0
   vxlan udp-port 4789
   vxlan vlan 100 vni 100
   vxlan vlan 200 vni 200
   vxlan learn-restrict any
!
ip routing
!
router bgp 65000
   router-id 10.0.254.0
   timers bgp 1 3
   maximum-paths 2 ecmp 2
   neighbor EVPN peer group
   neighbor EVPN remote-as 65000
   neighbor EVPN update-source Loopback0
   neighbor EVPN send-community extended
   neighbor 10.0.0.1 remote-as 65000
   neighbor 10.0.0.1 bfd
   neighbor 10.0.1.1 remote-as 65000
   neighbor 10.0.1.1 bfd
   neighbor 10.0.255.0 peer group EVPN
   neighbor 10.0.255.1 peer group EVPN
   !
   vlan 100
      rd 65000:100
      route-target import 65000:100
      route-target export 65000:100
      redistribute learned
   !
   vlan 200
      rd 65000:200
      route-target import 65000:200
      route-target export 65000:200
      redistribute learned
   !
   address-family evpn
      neighbor EVPN activate
   !
   address-family ipv4
      network 10.0.254.0/32
!

'''

LF0#sh bgp summ
BGP summary information for VRF default
Router identifier 10.0.254.0, local AS number 65000
Neighbor            AS Session State AFI/SAFI                AFI/SAFI State   NLRI Rcd   NLRI Acc
---------- ----------- ------------- ----------------------- -------------- ---------- ----------
10.0.0.1         65000 Established   IPv4 Unicast            Negotiated              8          8
10.0.1.1         65000 Established   IPv4 Unicast            Negotiated              8          8
10.0.255.0       65000 Established   IPv4 Unicast            Negotiated              8          8
10.0.255.0       65000 Established   L2VPN EVPN              Negotiated              2          2
10.0.255.1       65000 Established   IPv4 Unicast            Negotiated              8          8
10.0.255.1       65000 Established   L2VPN EVPN              Negotiated              2          2
LF0#

'''

LF0#show vxlan address-table
          Vxlan Mac Address Table
----------------------------------------------------------------------

VLAN  Mac Address     Type      Prt  VTEP             Moves   Last Move
----  -----------     ----      ---  ----             -----   ---------
 100  5000.00ae.f703  EVPN      Vx1  10.0.254.1       1       0:00:17 ago
 200  5000.002f.d8fe  EVPN      Vx1  10.0.254.2       1       0:00:22 ago
Total Remote Mac Addresses for this criterion: 2
LF0#
LF0#show vxlan vtep
Remote VTEPS for Vxlan1:

VTEP             Tunnel Type(s)
---------------- --------------
10.0.254.1       flood, unicast
10.0.254.2       flood, unicast

Total number of remote VTEPS:  2
LF0#
LF0#show bgp evpn route-type mac-ip
BGP routing table information for VRF default
Router identifier 10.0.254.0, local AS number 65000
Route status codes: * - valid, > - active, S - Stale, E - ECMP head, e - ECMP
                    c - Contributing to ECMP, % - Pending BGP convergence
Origin codes: i - IGP, e - EGP, ? - incomplete
AS Path Attributes: Or-ID - Originator ID, C-LST - Cluster List, LL Nexthop - Link Local Nexthop

          Network                Next Hop              Metric  LocPref Weight  Path
 * >Ec    RD: 65000:200 mac-ip 5000.002f.d8fe
                                 10.0.254.2            -       100     0       i Or-ID: 10.0.254.2 C-LST: 10.0.255.0
 *  ec    RD: 65000:200 mac-ip 5000.002f.d8fe
                                 10.0.254.2            -       100     0       i Or-ID: 10.0.254.2 C-LST: 10.0.255.1
 * >      RD: 65000:200 mac-ip 5000.0045.abdf
                                 -                     -       -       0       i
 * >      RD: 65000:100 mac-ip 5000.0088.fe27
                                 -                     -       -       0       i
 * >Ec    RD: 65000:100 mac-ip 5000.00ae.f703
                                 10.0.254.1            -       100     0       i Or-ID: 10.0.254.1 C-LST: 10.0.255.0
 *  ec    RD: 65000:100 mac-ip 5000.00ae.f703
                                 10.0.254.1            -       100     0       i Or-ID: 10.0.254.1 C-LST: 10.0.255.1
LF0#
LF0#sh interfaces vxlan 1
Vxlan1 is up, line protocol is up (connected)
  Hardware is Vxlan
  Source interface is Loopback0 and is active with 10.0.254.0
  Listening on UDP port 4789
  Replication/Flood Mode is headend with Flood List Source: EVPN
  Remote MAC learning via EVPN
  VNI mapping to VLANs
  Static VLAN to VNI mapping is
    [100, 100]        [200, 200]
  Note: All Dynamic VLANs used by VCS are internal VLANs.
        Use 'show vxlan vni' for details.
  Static VRF to VNI mapping is not configured
  Headend replication flood vtep list is:
   100 10.0.254.1
   200 10.0.254.2
  Shared Router MAC is 0000.0000.0000
LF0#
LF0#show vxlan vni
VNI to VLAN Mapping for Vxlan1
VNI       VLAN       Source       Interface       802.1Q Tag
--------- ---------- ------------ --------------- ----------
100       100        static       Ethernet7       untagged
                                  Vxlan1          100
200       200        static       Ethernet8       untagged
                                  Vxlan1          200

VNI to dynamic VLAN Mapping for Vxlan1
VNI       VLAN       VRF       Source
--------- ---------- --------- ------------

LF0#
